trigger:
  branches:
    include:
      - main

stages:
  - stage: DevDeploy
    displayName: "Dev - Terraform Apply"
    jobs:
      - template: templates/deploy-template.yml
        parameters:
          environment: 'dev'
          tfvarspath: 'todo-infra/environments/dev/dev.tfvars'
          runApply: true # Apply changes on merge to main

  - stage: ProdDeploy
    displayName: "Prod - Terraform Apply"
    jobs:
      - template: templates/deploy-template.yml
        parameters:
          environment: 'prod'
          tfvarspath: 'todo-infra/environments/prod/prod.tfvars'
          runApply: true # Apply changes on merge to main